/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i){var a=e.name,c=e.link,u=e.likes,s=e.myCard,l=e.cardId,f=e.userId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._cardName=a,this._cardImageLink=c,this._cardLikes=u,this._myCard=s,this._cardId=l,this._userId=f,this._cardTemplateSelector=n,this._handleCardClick=r,this._handleDeleteClick=o,this._handleLikeClick=i}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardTemplateSelector).content.cloneNode(!0)}},{key:"_likeCardHandler",value:function(){this._handleLikeClick(this._cardId,this._result)}},{key:"_removeCardHandler",value:function(){this._handleDeleteClick(this._cardId)}},{key:"_setEventListeners",value:function(){var e=this;this._card.querySelector(".cards__like-button").addEventListener("click",(function(){e._likeCardHandler()})),this._myCard&&this._card.querySelector(".cards__remove-button").addEventListener("click",(function(t){e._removeCardHandler(t)})),this._card.querySelector(".cards__image").addEventListener("click",(function(t){e._handleCardClick(e._cardName,e._cardImageLink)}))}},{key:"_checkMyLike",value:function(){for(var e=0;e<this._cardLikes.length;e++)this._cardLikes[e]._id===this._userId?this._result=!0:this._result=!1;return console.log("check "+this._result),this._result}},{key:"generateCard",value:function(){this._card=this._getTemplate();var e=this._card.querySelector(".cards__item"),t=this._card.querySelector(".cards__label"),n=this._card.querySelector(".cards__image"),r=this._card.querySelector(".cards__likes-counter"),o=this._card.querySelector(".cards__remove-button");return this._myCard||(o.hidden=!0),this._checkMyLike()&&this._card.querySelector(".cards__like-button").classList.add("cards__like-button_liked"),e.id=this._cardId,t.textContent=this._cardName,n.src=this._cardImageLink,n.alt=this._cardName,r.textContent=this._cardLikes.length,this._setEventListeners(),this._card}}])&&e(n.prototype,r),t}(),n=(document.querySelector(".image-box").querySelector(".image-box__close-button"),profileEditPopup.querySelector(".popup__form")),r=n.querySelector("#profileTitle"),o=n.querySelector("#profileSubtitle"),i=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),c="#profileEditPopup",u="#cardAddPopup",s=document.querySelector(".profile__avatar-button"),l={inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",submitButtonDisabledSelector:"popup__submit-button_disabled",inputInvalidSelector:"popup__input_invalid"};function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){var n,r,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){"Escape"===e.code&&o.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._popup=document.querySelector(t)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;(this._popup.querySelector(".popup__close-button")?this._popup.querySelector(".popup__close-button"):this._popup.querySelector(".image-box__close-button")).addEventListener("click",(function(){e.close()})),this._popup.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&e.close()}))}}])&&f(t.prototype,n),e}();function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(o){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function a(e,t){var n,r,o,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),c=function(e){e.preventDefault(),n._handleFormSubmit(n._getInputValues())},(o="_formSubmitFunction")in(r=v(n=i.call(this,e)))?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c,n._handleFormSubmit=t,n._form=n._popup.querySelector(".popup__form"),n}return t=a,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._form.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((function(t){return e._formValues[t.name]=t.value})),this._formValues}},{key:"formLoadingEnable",value:function(){this._form.querySelector(".popup__submit-button").textContent="Сохранение..."}},{key:"formLoadingDisable",value:function(){this._form.querySelector(".popup__submit-button").textContent="Сохранить"}},{key:"close",value:function(){this._form.reset(),_(b(a.prototype),"close",this).call(this)}},{key:"setEventListeners",value:function(){this._form.addEventListener("submit",this._formSubmitFunction),_(b(a.prototype),"setEventListeners",this).call(this)}}])&&h(t.prototype,n),a}(p);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(r);if(o){var n=L(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return C(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupSelector=document.querySelector(e),t}return t=a,(n=[{key:"open",value:function(e,t){var n=this._popupSelector.querySelector(".image-box__image"),r=this._popupSelector.querySelector(".image-box__label");n.src=t,r.textContent=e,n.alt=e,w(L(a.prototype),"open",this).call(this),document.addEventListener("keydown",this._handleEscClose)}}])&&g(t.prototype,n),a}(p);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?R(e):t}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(r);if(o){var n=x(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function a(e,t){var n,r,o,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),c=function(e){e.preventDefault(),n._handleFormSubmit(n._cardId),n.close()},(o="_formSubmitFunction")in(r=R(n=i.call(this,e)))?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c,n._handleFormSubmit=t,n._form=n._popup.querySelector(".popup__form"),n}return t=a,(n=[{key:"open",value:function(e){j(x(a.prototype),"open",this).call(this),this._cardId=e}},{key:"setEventListeners",value:function(){this._form.addEventListener("submit",this._formSubmitFunction),j(x(a.prototype),"setEventListeners",this).call(this)}}])&&q(t.prototype,n),a}(p);function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}},{key:"addItem",value:function(e,t){"start"===t?this._container.prepend(e):this._container.append(e)}}])&&B(t.prototype,n),e}();function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userSelector=t,this._aboutSelector=n,this._avatarSelector=r}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._profileInfo={},this._profileInfo.user=document.querySelector(this._userSelector).textContent,this._profileInfo.about=document.querySelector(this._aboutSelector).textContent,this._profileInfo.avatar=document.querySelector(this._avatarSelector).src,this._profileInfo}},{key:"setAvatar",value:function(e){document.querySelector(this._avatarSelector).src=e}},{key:"setUserInfo",value:function(e){var t=e.userId,n=e.profileTitle,r=e.profileSubtitle,o=e.avatarUrl;document.querySelector(this._userSelector).textContent=n,document.querySelector(this._aboutSelector).textContent=r,document.querySelector(this._avatarSelector).src=o,this._userId=t}}])&&U(t.prototype,n),e}();function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var N=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._form=n,this._inputSelector=t.inputSelector,this._submitButton=this._form.querySelector(t.submitButtonSelector),this._submitButtonDisabledSelector=t.submitButtonDisabledSelector,this._inputInvalidSelector=t.inputInvalidSelector}var t,n;return t=e,(n=[{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"_showError",value:function(e){this._form.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.add(this._inputInvalidSelector)}},{key:"_hideError",value:function(e){this._form.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(this._inputInvalidSelector)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideError(e):this._showError(e)}},{key:"setButtonState",value:function(){this._form.checkValidity()?(this._submitButton.classList.remove(this._submitButtonDisabledSelector),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._submitButtonDisabledSelector),this._submitButton.disabled=!0)}},{key:"_setEventListeners",value:function(){var e=this;this._form.querySelectorAll(this._inputSelector).forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.setButtonState()}))}))}},{key:"clearValidationMessages",value:function(){var e=this;this._form.querySelectorAll(this._inputSelector).forEach((function(t){e._hideError(t)}))}}])&&F(t.prototype,n),e}();function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H=new(function(){function e(t){var n=t.address,r=t.token,o=t.groupId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._address=n,this._token=r,this._groupId=o}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return fetch("".concat(this._address,"/").concat(this._groupId,"/users/me"),{headers:{authorization:this._token}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._address,"/").concat(this._groupId,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}},{key:"getCards",value:function(){return fetch("".concat(this._address,"/").concat(this._groupId,"/cards"),{headers:{authorization:this._token}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}},{key:"createCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._address,"/").concat(this._groupId,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._address,"/").concat(this._groupId,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token}}).then((function(t){return t.ok?e:Promise.reject("Ошибка ".concat(t.status))}))}},{key:"likeCard",value:function(e,t){return this._like=t?"PUT":"DELETE",fetch("".concat(this._address,"/").concat(this._groupId,"/cards/likes/").concat(e),{method:this._like,headers:{authorization:this._token}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}},{key:"setAvatar",value:function(e){return fetch("".concat(this._address,"/").concat(this._groupId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))}}])&&z(t.prototype,n),e}())({address:"https://mesto.nomoreparties.co/v1",token:"f8102ab5-70c3-4d68-8d03-549794a26a19",groupId:"cohort-20"}),M=new A(".profile__title",".profile__subtitle",".profile__avatar");H.getUserInfo().then((function(e){M.setUserInfo({userId:e._id,profileTitle:e.name,profileSubtitle:e.about,avatarUrl:e.avatar})})).catch((function(e){return console.log("При загрузке данных возникла ошибка: ".concat(e.status))}));var J=new S(c,(function(e){J.formLoadingEnable(),H.setUserInfo({name:e.profileTitle,about:e.profileSubtitle}).then((function(e){M.setUserInfo({profileTitle:e.name,profileSubtitle:e.about,avatarUrl:e.avatar})})).catch((function(e){return console.log("При загрузке данных возникла ошибка: ".concat(e.status))})).finally((function(){J.formLoadingDisable(),J.close()}))}));J.setEventListeners();var G=new N(l,document.querySelector(u).querySelector(".popup__form"));G.enableValidation();var K=new N(l,document.querySelector(c).querySelector(".popup__form"));K.enableValidation();var Q=new I(".image-box");Q.setEventListeners();var W=function(e,t){Q.open(e,t)},X=new D(".popup_type_delete",(function(e){H.deleteCard(e).then((function(e){document.querySelector("#".concat(CSS.escape(e))).remove()})).catch((function(e){return console.log("При удалении карточки возникла ошибка: ".concat(e.status))}))}));X.setEventListeners();var Y=function(e){X.open(e)},Z=function(e,t){H.likeCard(e,!t).then((function(e){var t=document.querySelector("#".concat(CSS.escape(e._id)));console.log(e.likes),t.querySelector(".cards__likes-counter").textContent=e.likes.length,t.querySelector(".cards__like-button").classList.toggle("cards__like-button_liked")})).catch((function(e){return console.log("При лайке карточки возникла ошибка: ".concat(e.status))}))},$=new V({renderer:function(e){var n=M._userId===e.owner._id,r=new t({name:e.name,link:e.link,likes:e.likes,myCard:n,cardId:e._id,userId:M._userId},".card-template",W,Y,Z).generateCard();$.addItem(r)}},".cards__list");H.getCards().then((function(e){$.renderItems(e)})).catch((function(e){return console.log("При загрузке данных возникла ошибка: ".concat(e.status))}));var ee=new S(u,(function(e){ee.formLoadingEnable(),H.createCard({name:e.placeLabel,link:e.placeImage}).then((function(e){var n=new t({name:e.name,link:e.link,likes:e.likes,myCard:!0,cardId:e._id},".card-template",W,Y,Z).generateCard();$.addItem(n,"start")})).catch((function(e){return console.log("При загрузке данных возникла ошибка: ".concat(e.status))})).finally((function(){ee.formLoadingDisable(),ee.close()}))}));ee.setEventListeners(),i.addEventListener("click",(function(){var e=M.getUserInfo();r.value=e.user,o.value=e.about,K.clearValidationMessages(),K.setButtonState(),J.open()})),a.addEventListener("click",(function(){G.clearValidationMessages(),G.setButtonState(),ee.open()}));var te=new S("#profileChangeAvatar",(function(e){var t=e.avatarLink;te.formLoadingEnable(),H.setAvatar(t).then((function(e){M.setAvatar(e.avatar)})).catch((function(e){return console.log("При изменении аватара возникла ошибка: ".concat(e.status))})).finally((function(){te.formLoadingDisable(),te.close()}))})),ne=document.querySelector(".popup__container_type_avatar").querySelector(".popup__form");te.setEventListeners(),new N(l,ne).enableValidation(),s.addEventListener("click",(function(){te.open()}))})();
//# sourceMappingURL=index.js.map