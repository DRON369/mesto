(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t,n,r,o,i){var a=t.name,c=t.link,u=t.likes,s=t.myCard,l=t.cardId,f=t.userId;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardName=a,this._cardImageLink=c,this._cardLikes=u,this._myCard=s,this._cardId=l,this._userId=f,this._cardTemplateSelector=n,this._handleCardClick=r,this._handleDeleteClick=o,this._handleLikeClick=i}var n,r;return n=e,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardTemplateSelector).content.cloneNode(!0)}},{key:"_likeCardHandler",value:function(){this._handleLikeClick(this._cardId,this._like,this),this.like()}},{key:"updateLikes",value:function(t){this._cardLikesCounter.textContent=t.length,this._cardLikeToggle.classList.toggle("cards__like-button_liked")}},{key:"_removeCardHandler",value:function(){this._handleDeleteClick(this._cardId)}},{key:"_setEventListeners",value:function(){var t=this;this._cardLikeToggle.addEventListener("click",(function(){t._likeCardHandler()})),this._myCard&&this._cardDeleteButton.addEventListener("click",(function(e){t._removeCardHandler(e)})),this._cardImage.addEventListener("click",(function(e){t._handleCardClick(t._cardName,t._cardImageLink)}))}},{key:"_checkMyLike",value:function(){for(var t=0;t<this._cardLikes.length;t++)this._cardLikes[t]._id===this._userId?this._result=!0:this._result=!1;return this._result}},{key:"like",value:function(){this._like=!this._like}},{key:"generateCard",value:function(){return this._card=this._getTemplate(),this._cardContainer=this._card.querySelector(".cards__item"),this._cardLabel=this._card.querySelector(".cards__label"),this._cardImage=this._card.querySelector(".cards__image"),this._cardLikesCounter=this._card.querySelector(".cards__likes-counter"),this._cardLikeToggle=this._card.querySelector(".cards__like-button"),this._cardDeleteButton=this._card.querySelector(".cards__remove-button"),this._myCard||(this._cardDeleteButton.hidden=!0),this._like=this._checkMyLike(),this._like&&this._cardLikeToggle.classList.add("cards__like-button_liked"),this._cardContainer.id=this._cardId,this._cardLabel.textContent=this._cardName,this._cardImage.src=this._cardImageLink,this._cardImage.alt=this._cardName,this._cardLikesCounter.textContent=this._cardLikes.length,this._setEventListeners(),this._card}}])&&t(n.prototype,r),e}(),n=(document.querySelector(".popup_type_image").querySelector(".popup__close-button"),profileEditPopup.querySelector(".popup__form")),r=n.querySelector("#profileTitle"),o=n.querySelector("#profileSubtitle"),i=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),c="#profileEditPopup",u="#cardAddPopup",s=document.querySelector(".profile__avatar-button"),l={inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",submitButtonDisabledSelector:"popup__submit-button_disabled",inputInvalidSelector:"popup__input_invalid"};function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var p=function(){function t(e){var n,r,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(t){"Escape"===t.code&&o.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".popup__close-button")}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var t=this;this._closeButton.addEventListener("click",(function(){t.close()})),this._popup.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&t.close()}))}}])&&f(e.prototype,n),t}();function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e,n){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?b(t):e}function b(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=m(r);if(o){var n=m(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return v(this,t)});function a(t,e){var n,r,o,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),c=function(t){t.preventDefault(),n._handleFormSubmit(n._getInputValues())},(o="_formSubmitFunction")in(r=b(n=i.call(this,t)))?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c,n._handleFormSubmit=e,n._form=n._popup.querySelector(".popup__form"),n._inputList=n._form.querySelectorAll(".popup__input"),n._submitButton=n._form.querySelector(".popup__submit-button"),n}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"formLoadingEnable",value:function(){this._submitButton.textContent="Сохранение..."}},{key:"formLoadingDisable",value:function(){this._submitButton.textContent="Сохранить"}},{key:"close",value:function(){this._form.reset(),_(m(a.prototype),"close",this).call(this)}},{key:"setEventListeners",value:function(){this._form.addEventListener("submit",this._formSubmitFunction),_(m(a.prototype),"setEventListeners",this).call(this)}}])&&d(e.prototype,n),a}(p);function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(t,e,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=C(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(t,e){return!e||"object"!==g(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=C(r);if(o){var n=C(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return E(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._imageToView=e._popup.querySelector(".popup__image"),e._imageToViewLabel=e._popup.querySelector(".popup__label_type_image"),e}return e=a,(n=[{key:"open",value:function(t,e){this._imageToView.src=e,this._imageToViewLabel.textContent=t,this._imageToView.alt=t,L(C(a.prototype),"open",this).call(this)}}])&&S(e.prototype,n),a}(p);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function j(t,e,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function q(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?R(t):e}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(r);if(o){var n=D(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return q(this,t)});function a(t,e){var n,r,o,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),c=function(t){t.preventDefault(),n._handleFormSubmit(n._cardId),n.close()},(o="_formSubmitFunction")in(r=R(n=i.call(this,t)))?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c,n._handleFormSubmit=e,n._form=n._popup.querySelector(".popup__form"),n}return e=a,(n=[{key:"open",value:function(t){j(D(a.prototype),"open",this).call(this),this._cardId=t}},{key:"setEventListeners",value:function(){this._form.addEventListener("submit",this._formSubmitFunction),j(D(a.prototype),"setEventListeners",this).call(this)}}])&&P(e.prototype,n),a}(p);function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var x=function(){function t(e,n){var r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=r,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"renderItems",value:function(t){var e=this;t.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(t,e){"start"===e?this._container.prepend(t):this._container.append(t)}}])&&V(e.prototype,n),t}();function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var A=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._user=document.querySelector(e),this._about=document.querySelector(n),this._avatar=document.querySelector(r),this._profileInfo={}}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return this._profileInfo.user=this._user.textContent,this._profileInfo.about=this._about.textContent,this._profileInfo.avatar=this._avatar.src,this._profileInfo}},{key:"setAvatar",value:function(t){this._avatar.src=t}},{key:"setUserInfo",value:function(t){var e=t.userId,n=t.profileTitle,r=t.profileSubtitle,o=t.avatarUrl;this._user.textContent=n,this._about.textContent=r,this._avatar.src=o,this.userId=e}}])&&U(e.prototype,n),t}();function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var N=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._form=n,this._inputSelector=e.inputSelector,this._submitButton=this._form.querySelector(e.submitButtonSelector),this._submitButtonDisabledSelector=e.submitButtonDisabledSelector,this._inputInvalidSelector=e.inputInvalidSelector,this._inputList=this._form.querySelectorAll(this._inputSelector)}var e,n;return e=t,(n=[{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"_showError",value:function(t){this._form.querySelector("#".concat(t.id,"-error")).textContent=t.validationMessage,t.classList.add(this._inputInvalidSelector)}},{key:"_hideError",value:function(t){this._form.querySelector("#".concat(t.id,"-error")).textContent="",t.classList.remove(this._inputInvalidSelector)}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideError(t):this._showError(t)}},{key:"setButtonState",value:function(){this._form.checkValidity()?(this._submitButton.classList.remove(this._submitButtonDisabledSelector),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._submitButtonDisabledSelector),this._submitButton.disabled=!0)}},{key:"_setEventListeners",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t.setButtonState()}))}))}},{key:"clearValidationMessages",value:function(){var t=this;this._inputList.forEach((function(e){t._hideError(e)}))}}])&&F(e.prototype,n),t}();function z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var M=new(function(){function t(e){var n=e.address,r=e.token,o=e.groupId;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._address=n,this._token=r,this._groupId=o}var e,n;return e=t,(n=[{key:"_checkResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._address,"/").concat(this._groupId,"/users/me"),{headers:{authorization:this._token}}).then(this._checkResponse)}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.about;return fetch("".concat(this._address,"/").concat(this._groupId,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then(this._checkResponse)}},{key:"getCards",value:function(){return fetch("".concat(this._address,"/").concat(this._groupId,"/cards"),{headers:{authorization:this._token}}).then(this._checkResponse)}},{key:"createCard",value:function(t){var e=t.name,n=t.link;return fetch("".concat(this._address,"/").concat(this._groupId,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:n})}).then(this._checkResponse)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._address,"/").concat(this._groupId,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then((function(e){return e.ok?t:Promise.reject("Ошибка ".concat(e.status))}))}},{key:"likeCard",value:function(t,e){return this._like=e?"PUT":"DELETE",fetch("".concat(this._address,"/").concat(this._groupId,"/cards/likes/").concat(t),{method:this._like,headers:{authorization:this._token}}).then(this._checkResponse)}},{key:"setAvatar",value:function(t){return fetch("".concat(this._address,"/").concat(this._groupId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(this._checkResponse)}}])&&z(e.prototype,n),t}())({address:"https://mesto.nomoreparties.co/v1",token:"f8102ab5-70c3-4d68-8d03-549794a26a19",groupId:"cohort-20"}),H=new A(".profile__title",".profile__subtitle",".profile__avatar");function J(t){var n=H.userId===t.owner._id;return new e({name:t.name,link:t.link,likes:t.likes,myCard:n,cardId:t._id,userId:H.userId},".card-template",(function(t,e){X.open(t,e)}),(function(t){Y.open(t)}),(function(t,e,n){M.likeCard(t,!e).then((function(t){n.updateLikes(t.likes)})).catch((function(t){return console.log("При лайке карточки возникла ошибка: ".concat(t.status))}))}))}Promise.all([M.getUserInfo().then((function(t){H.setUserInfo({userId:t._id,profileTitle:t.name,profileSubtitle:t.about,avatarUrl:t.avatar})})).catch((function(t){return console.log("При загрузке данных возникла ошибка: ".concat(t.status))})),M.getCards().then((function(t){G.renderItems(t)})).catch((function(t){return console.log("При загрузке данных возникла ошибка: ".concat(t.status))}))]).catch((function(t){return console.log("При загрузке данных возникла ошибка: ".concat(t.status))}));var G=new x({renderer:function(t){var e=J(t).generateCard();G.addItem(e)}},".cards__list"),K=new k(c,(function(t){K.formLoadingEnable(),M.setUserInfo({name:t.profileTitle,about:t.profileSubtitle}).then((function(t){H.setUserInfo({profileTitle:t.name,profileSubtitle:t.about,avatarUrl:t.avatar})})).catch((function(t){return console.log("При загрузке данных возникла ошибка: ".concat(t.status))})).finally((function(){K.formLoadingDisable(),K.close()}))}));K.setEventListeners();var Q=new N(l,document.querySelector(u).querySelector(".popup__form"));Q.enableValidation();var W=new N(l,document.querySelector(c).querySelector(".popup__form"));W.enableValidation();var X=new I(".popup_type_image");X.setEventListeners();var Y=new B(".popup_type_delete",(function(t){M.deleteCard(t).then((function(t){document.querySelector("#".concat(CSS.escape(t))).remove()})).catch((function(t){return console.log("При удалении карточки возникла ошибка: ".concat(t.status))}))}));Y.setEventListeners();var Z=new k(u,(function(t){Z.formLoadingEnable(),M.createCard({name:t.placeLabel,link:t.placeImage}).then((function(t){var e=J(t).generateCard();G.addItem(e,"start")})).catch((function(t){return console.log("При загрузке данных возникла ошибка: ".concat(t.status))})).finally((function(){Z.formLoadingDisable(),Z.close()}))}));Z.setEventListeners(),i.addEventListener("click",(function(){var t=H.getUserInfo();r.value=t.user,o.value=t.about,W.clearValidationMessages(),W.setButtonState(),K.open()})),a.addEventListener("click",(function(){Q.clearValidationMessages(),Q.setButtonState(),Z.open()}));var $=new k("#profileChangeAvatar",(function(t){var e=t.avatarLink;$.formLoadingEnable(),M.setAvatar(e).then((function(t){H.setAvatar(t.avatar)})).catch((function(t){return console.log("При изменении аватара возникла ошибка: ".concat(t.status))})).finally((function(){$.formLoadingDisable(),$.close()}))})),tt=document.querySelector(".popup__container_type_avatar").querySelector(".popup__form");$.setEventListeners();var et=new N(l,tt);et.enableValidation(),s.addEventListener("click",(function(){et.clearValidationMessages(),$.open()}))})();
//# sourceMappingURL=index.js.map